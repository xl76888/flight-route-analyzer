# 航线可视化工具功能说明文档

## 📋 项目概述

本工具是一个基于 Streamlit 和 Folium 的航线数据可视化分析平台，专门用于处理和展示航空公司的货运航线数据。支持多种数据格式导入、智能数据清洗、交互式地图可视化以及多维度数据分析。

## 🚀 核心功能模块

### 1. 数据导入与解析 (`parser.py`)

#### 智能表格结构检测
- **自动识别列结构**：智能检测航空公司、航线、机型、航班号等关键列
- **多格式支持**：支持 Excel (.xlsx) 和 CSV (.csv) 格式
- **合并单元格处理**：自动处理 Excel 中的合并单元格
- **航线文本解析**：解析复杂的航线描述文本，提取起点和终点信息

#### 航线解析算法
- **正则表达式匹配**：使用正则表达式提取 IATA 机场代码
- **多段航线支持**：支持包含中转站的复杂航线
- **城市名称清理**：自动清理和标准化城市名称

### 2. 数据清洗与标准化 (`data_cleaner.py`)

#### 城市名称标准化
- **城市映射表**：包含 200+ 个城市的标准化映射
- **机场名称转换**：将机场名称转换为对应城市名称
- **重复数据处理**：智能去重，保留最完整的记录

#### 数据质量控制
- **缺失值处理**：智能填充和标记缺失数据
- **格式统一**：统一日期、数字等格式
- **异常值检测**：识别和处理异常数据

### 3. 地理坐标系统 (`airport_coords.py`)

#### 全球机场坐标库
- **400+ 机场坐标**：覆盖全球主要机场的精确坐标
- **多重匹配**：支持城市名称和 IATA 代码双重匹配
- **坐标验证**：自动验证坐标的有效性

#### 坐标获取策略
- **本地优先**：优先使用本地坐标库
- **在线查询**：支持在线 API 查询缺失坐标
- **手动补充**：支持用户手动添加坐标

### 4. 交互式地图可视化 (`web_app.py`)

#### 地图基础功能
- **多种地图样式**：CartoDB Light、Dark、卫星图等多种瓦片源
- **自适应缩放**：根据航线分布自动调整地图视野
- **小地图导航**：提供缩略图导航功能
- **强制刷新机制**：解决地图缓存问题

#### 航线可视化
- **动态航线**：高频航线使用 AntPath 动画效果
- **颜色编码**：按航空公司、频次等维度进行颜色区分
- **透明度控制**：根据航线重要性调整透明度
- **跨太平洋优化**：特殊处理跨越国际日期变更线的航线

#### 机场标记系统
- **分级显示**：根据航班数量分为枢纽、重要、一般机场
- **动态图标**：图标大小和颜色反映机场重要性
- **详细信息**：点击显示机场统计信息和航司分布
- **影响范围**：重要机场显示服务范围圆圈

### 5. 多维度数据筛选

#### 基础筛选
- **航空公司筛选**：支持多选航空公司
- **起降地筛选**：支持起点和终点城市筛选
- **机型筛选**：按飞机型号筛选
- **方向筛选**：区分出口和进口航线

#### 高级筛选
- **航线类型**：国内航线、国际航线分类
- **组合筛选**：国际出口、国际进口、国内出口等组合条件
- **往返航线视图**：自动配对往返航线并显示统计
- **频次筛选**：按航班频次筛选航线

### 6. 数据分析与统计

#### 航线分析
- **频次统计**：计算每条航线的航班频次
- **中转地分析**：识别潜在的中转枢纽
- **航司分布**：分析各机场的航司构成
- **机型分析**：统计不同机型的使用情况

#### 可视化图表
- **航司分布饼图**：展示航司市场份额
- **机型分布图**：显示机型使用统计
- **航线频次图**：展示航线繁忙程度
- **地理分布图**：显示航线地理分布特征

### 7. 数据导出功能

#### 地图导出
- **HTML 格式**：导出完整的交互式地图
- **高分辨率**：支持高质量地图导出
- **自定义样式**：保留所有可视化设置

#### 数据导出
- **Excel 格式**：导出筛选后的数据
- **完整信息**：包含所有分析结果
- **格式化输出**：美化的表格格式

## 🛠️ 技术架构

### 前端技术
- **Streamlit**：Web 应用框架
- **Folium**：地图可视化库
- **HTML/CSS/JavaScript**：自定义样式和交互

### 后端技术
- **Pandas**：数据处理和分析
- **NumPy**：数值计算
- **正则表达式**：文本解析

### 地图技术
- **CartoDB 瓦片服务**：高质量地图瓦片
- **AntPath 插件**：动画航线效果
- **大圆路径算法**：精确的航线绘制

## 📊 数据处理流程

### 1. 数据导入阶段
```
原始 Excel/CSV 文件 → 结构检测 → 列映射 → 数据提取
```

### 2. 数据清洗阶段
```
原始数据 → 城市名称标准化 → 重复数据处理 → 缺失值填充 → 格式统一
```

### 3. 坐标匹配阶段
```
城市名称 → 本地坐标库查询 → 在线 API 查询 → 坐标验证 → 坐标分配
```

### 4. 可视化渲染阶段
```
清洗数据 → 航线计算 → 地图初始化 → 图层添加 → 交互功能
```

## 🎯 使用场景

### 航空公司运营分析
- **航线网络优化**：分析现有航线网络的覆盖情况
- **市场份额分析**：了解在不同机场的竞争地位
- **运力配置**：优化机型在不同航线上的配置

### 机场运营管理
- **航司招商**：了解潜在航司的航线网络
- **容量规划**：根据航线分布规划机场容量
- **服务优化**：针对主要航司优化服务

### 行业研究分析
- **市场趋势**：分析航线发展趋势
- **竞争格局**：了解行业竞争态势
- **政策影响**：评估政策对航线的影响

## 🔧 安装与部署

### 环境要求
- Python 3.8+
- 依赖包见 `requirements.txt`

### 快速启动
```bash
# 安装依赖
pip install -r requirements.txt

# 启动应用
streamlit run web_app.py

# 或使用批处理文件
start.bat
```

### 配置说明
- **数据目录**：`data/` 文件夹存放数据文件
- **坐标库**：`airport_coords.py` 包含机场坐标
- **清洗规则**：`data_cleaner.py` 定义清洗规则

## 📈 性能特点

### 处理能力
- **大数据支持**：支持万级航线数据处理
- **实时渲染**：秒级地图渲染速度
- **内存优化**：高效的内存使用策略

### 用户体验
- **响应式设计**：适配不同屏幕尺寸
- **直观操作**：简洁的用户界面
- **实时反馈**：即时的操作反馈

## 🔮 未来发展

### 功能扩展
- **时间序列分析**：支持历史数据对比
- **预测分析**：基于历史数据的趋势预测
- **多语言支持**：国际化界面

### 技术升级
- **云端部署**：支持云端部署和访问
- **API 接口**：提供数据 API 接口
- **移动端适配**：优化移动端体验

---

*本文档最后更新时间：2024年12月*
*版本：v1.0*