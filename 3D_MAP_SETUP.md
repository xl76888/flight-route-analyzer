# 🌐 3D地图功能设置指南

## 📋 功能概述

航线分析工具现已支持3D地图功能，提供更加直观和沉浸式的航线可视化体验。用户可以在传统的2D地图和新的3D地图之间自由切换。

## ✨ 功能特性

### 🎯 核心功能
- **3D航线绘制**：立体显示航线路径，支持高度设置
- **机场3D标记**：三维机场位置标记，支持自定义样式
- **动态视角控制**：自由旋转、缩放和倾斜视角
- **智能相机控制**：自动适应航线范围，优化观察角度
- **实时数据同步**：与2D地图共享筛选条件和数据状态

### 🎨 视觉效果
- **航线分类着色**：国内/国际航线不同颜色区分
- **频率可视化**：根据航班频率调整线条粗细和透明度
- **高度模拟**：不同类型航线显示不同飞行高度
- **动画效果**：高频航线支持动态流动效果
- **标签显示**：机场代码和航线信息悬浮显示

## 🔧 配置要求

### 1. Google Maps API 设置

#### 获取API密钥
1. 访问 [Google Cloud Console](https://console.cloud.google.com/)
2. 创建新项目或选择现有项目
3. 启用以下API服务：
   - **Maps JavaScript API**
   - **Maps 3D API (beta)**
   - **Geocoding API**（可选，用于地址解析）

4. 创建API密钥：
   - 导航到「凭据」页面
   - 点击「创建凭据」→「API密钥」
   - 复制生成的API密钥

#### 配置API密钥限制（推荐）
为了安全起见，建议为API密钥设置使用限制：

1. **应用程序限制**：
   - 选择「HTTP引用站点」
   - 添加您的域名（如：`localhost:8501`、`your-domain.com`）

2. **API限制**：
   - 选择「限制密钥」
   - 选择已启用的Maps API

### 2. 地图ID配置

#### 创建地图样式
1. 访问 [Google Maps Platform](https://console.cloud.google.com/google/maps-apis/studio/maps)
2. 点击「创建地图ID」
3. 选择「JavaScript」作为地图类型
4. 配置地图样式（可选）
5. 启用「3D功能」
6. 保存并复制地图ID

### 3. 本地配置

#### 方法一：Streamlit Secrets（推荐）

在项目根目录创建 `.streamlit/secrets.toml` 文件：

```toml
# Google Maps API 配置
GOOGLE_MAPS_API_KEY = "your_actual_api_key_here"
GOOGLE_MAPS_MAP_ID = "your_actual_map_id_here"
```

#### 方法二：环境变量

**Windows (PowerShell):**
```powershell
$env:GOOGLE_MAPS_API_KEY="your_actual_api_key_here"
$env:GOOGLE_MAPS_MAP_ID="your_actual_map_id_here"
```

**Linux/macOS:**
```bash
export GOOGLE_MAPS_API_KEY="your_actual_api_key_here"
export GOOGLE_MAPS_MAP_ID="your_actual_map_id_here"
```

## 🚀 使用方法

### 1. 启动应用
```bash
cd D:\flight_tool
streamlit run web_app.py
```

### 2. 切换到3D地图
1. 在左侧边栏找到「👁️ 视图模式」部分
2. 在「地图类型」中选择「3D地图」
3. 系统将自动检查API配置状态

### 3. 3D地图控制

#### 基础操作
- **旋转**：鼠标左键拖拽
- **缩放**：鼠标滚轮或双击
- **倾斜**：Ctrl + 鼠标拖拽
- **平移**：Shift + 鼠标拖拽

#### 控制面板
- **视图模式**：标准视图、鸟瞰视图、侧视图、自由视角
- **启用动画**：开启/关闭航线动画效果
- **显示标签**：控制机场和航线标签显示
- **高度缩放**：调整航线飞行高度显示比例
- **线条宽度**：调整航线线条粗细
- **透明度**：调整航线透明度
- **渲染质量**：选择渲染质量等级

## 📊 数据展示

### 统计信息
3D地图模式下会显示专门的统计面板：
- **3D航线数量**：当前显示的航线总数
- **机场数量**：涉及的唯一机场数量
- **航司数量**：涉及的航空公司数量
- **平均频率**：航线的平均飞行频率

### 航线分类
- **国内航线**：蓝色显示，较低飞行高度
- **国际航线**：橙色显示，较高飞行高度
- **高频航线**：红色显示，最高飞行高度，支持动画
- **货运航线**：绿色显示，中等飞行高度

## ⚠️ 注意事项

### 性能要求
- **浏览器**：需要支持WebGL的现代浏览器
- **内存**：建议至少4GB可用内存
- **网络**：需要稳定的互联网连接访问Google服务

### 使用限制
- **API配额**：Google Maps API有使用配额限制
- **数据量**：大量航线可能影响渲染性能
- **Beta功能**：3D Maps API目前处于beta阶段

### 故障排除

#### 常见问题

**1. 3D地图无法加载**
- 检查API密钥是否正确配置
- 确认已启用必要的API服务
- 检查网络连接是否正常

**2. 显示"API未配置"警告**
- 确认 `.streamlit/secrets.toml` 文件存在且格式正确
- 检查API密钥是否有效
- 验证地图ID是否正确

**3. 性能问题**
- 减少显示的航线数量（使用筛选功能）
- 降低渲染质量设置
- 关闭动画效果

**4. 浏览器兼容性**
- 使用Chrome、Firefox、Safari或Edge的最新版本
- 确保浏览器支持WebGL
- 禁用可能冲突的浏览器扩展

## 💡 最佳实践

### 数据筛选
- 使用筛选功能减少同时显示的航线数量
- 按航司或机场筛选以获得更清晰的视图
- 利用高级筛选功能聚焦特定数据

### 视角控制
- 使用"适应范围"按钮快速定位到数据区域
- 尝试不同的视图模式以获得最佳观察角度
- 利用"重置视角"功能回到默认视图

### 性能优化
- 在处理大量数据时选择较低的渲染质量
- 根据需要开启/关闭动画效果
- 定期清理浏览器缓存以保持最佳性能

## 🔄 版本更新

当前版本：v1.0.0

### 后续计划
- [ ] 支持自定义航线颜色方案
- [ ] 添加时间轴动画功能
- [ ] 集成天气数据显示
- [ ] 支持VR/AR查看模式
- [ ] 添加航线密度热力图

## 📞 技术支持

如果在使用过程中遇到问题，请：

1. 查看本文档的故障排除部分
2. 检查浏览器控制台的错误信息
3. 确认API配置是否正确
4. 联系技术支持团队

---

**祝您使用愉快！** 🎉