# 用户问题分析报告

## 问题总结

根据用户反馈，发现以下几个问题：

### 1. IATA航线字段名称问题
**问题描述**：用户希望将"IATA航线"字段名改为"机场代码"

**当前状态**：
- 在 `web_app.py` 第2429行，字段显示名为：`'iata_route': '🔤 IATA航线'`
- 数据来源：`parse_sixteen_airlines.py` 中从Excel的 `'出口航线（机场—机场）.1'` 和 `'进口航线（机场—机场）.1'` 列获取

**解决方案**：修改字段显示名称

### 2. 每周班次数据来源问题
**问题描述**：用户询问每周班次数据的来源

**数据来源分析**：
- **原始数据源**：Excel文件 `中国十六家货航国际航线.xlsx`
- **具体字段**：
  - 出口航线：`'每周班次'` 列
  - 进口航线：`'每周班次.1'` 列
- **处理位置**：`parse_sixteen_airlines.py` 第51行和第81行
- **数据流程**：
  1. 从Excel原始数据中提取
  2. 在 `web_app.py` 第2370-2383行进行格式化处理
  3. 添加"班/周"单位显示

**结论**：每周班次数据完全来自原始Excel数据源，不是计算得出的

### 3. 控制面板动画效果无反应问题
**问题描述**：点击控制面板的动画效果按钮无反应

**技术分析**：
- **控制面板位置**：`components/map3d/optimized_map3d_component.html` 第216-230行
- **动画控制函数**：`toggleAnimation()` 函数在第1122行
- **问题原因**：
  1. Streamlit环境下HTML组件的JavaScript事件绑定可能存在问题
  2. 3D地图组件与Streamlit的交互机制限制
  3. 可能存在JavaScript错误阻止事件执行

**动画效果说明**：
- **功能**：控制高频航线的动态流动效果
- **实现**：使用AntPath插件创建移动的动画点
- **触发条件**：航线频次 >= 5 班/周时启用动画
- **控制方式**：
  - 动画开关：开启/关闭动画效果
  - 动画速度：调节动画播放速度（默认2000ms）

## 修复建议

### 1. 字段名称修改
```python
# 在 web_app.py 第2429行修改
'iata_route': '✈️ 机场代码',
```

### 2. 每周班次数据说明
- 数据来源：原始Excel文件，无需修改
- 建议：在界面上添加数据来源说明

### 3. 控制面板动画修复
- **短期方案**：在Streamlit侧边栏添加动画控制选项
- **长期方案**：优化HTML组件与Streamlit的交互机制

## 实施优先级

1. **高优先级**：字段名称修改（简单快速）
2. **中优先级**：添加数据来源说明
3. **低优先级**：控制面板动画修复（需要深度调试）

## 技术细节

### 数据处理流程
```
Excel原始数据 → parse_sixteen_airlines.py → web_app.py → 前端显示
     ↓              ↓                    ↓
  每周班次字段    提取并清理数据        格式化显示
```

### 动画实现机制
```
高频航线判断 → 创建AntPath → 添加动画点 → 控制面板交互
    ↓              ↓           ↓           ↓
  频次>=5        动画路径    移动效果    开关控制
```